<div class="row mb-5">
    <div class="col">
        <div>
            <img src="img/heroku-sf-rest.png" alt="">
        </div>        
    </div>
    <div class="col">
        {{#if connection }}
            <p>Instance Url: {{connection.instanceUrl}}</p>
            <p>User id: {{ connection.userId }}</p>
            <p>Organization id: {{ connection.orgId }}</p>
            <p>Access Token: {{ connection.accessToken }}</p>
        {{else}}
            <a class="btn btn-primary mb-5" href="/oauth">Oauth login</a>
        {{/if}}
        <button id="accounts" class="btn btn-secondary mb-5">Get Accounts via REST API</button>
        <div id="result"></div>
    </div>
</div>



<script>

    const button = document.getElementById('accounts');

    button.addEventListener('click', function(e) {
        let item = '';
        fetch('/sfrestapi/accounts')
        .then(res => {
            if (!res.ok) {
                console.log(res);
                throw Error(res.statusText);
            } 
            return res.json();
        })
        .then((res) => {
            console.log(res)
            res.response.forEach(function (record) {
                item += '<div class="card col col-3 mb-3">' + 
                            '<div class="card-body">'+
                                '<h5 class="card-title">'+record.Name+'</h5>'+
                                '<h6 class="card-subtitle mb-2 text-muted">'+record.Phone+'</h6>'+
                                '<p class="card-text">'+ record.Description +'</p>'+
                            '</div>' +    
                        '</div>';
            });
            document.getElementById('result').innerHTML = item;
        })
        .catch(function(error) {
            item += '<div class="col alert alert-danger">' + error + '</div>';
            document.getElementById('result').innerHTML = item;
            console.log(error);

        });
    })

</script>